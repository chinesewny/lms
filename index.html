<!DOCTYPE html>
<html lang="th">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>ระบบจัดการการสอนภาษาจีน</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
    <link href="https://fonts.googleapis.com/css2?family=Kanit:wght@300;400;500;600;700&display=swap" rel="stylesheet">
    <style>
        body {
            font-family: 'Kanit', sans-serif;
            background-color: #fef2f2;
        }
        .sidebar {
            transition: transform 0.3s ease-in-out;
        }
        .main-content {
            transition: margin-left 0.3s ease-in-out;
        }
        .modal, .loader-overlay {
            display: none;
            align-items: center;
            justify-content: center;
            opacity: 0;
            transition: opacity 0.3s ease-in-out;
        }
        .modal.active, .loader-overlay.active {
            display: flex;
            opacity: 1;
        }
        .modal-content {
            transform: scale(0.95);
            transition: transform 0.3s ease-in-out;
        }
        .modal.active .modal-content {
             transform: scale(1);
        }
        /* Custom scrollbar */
        ::-webkit-scrollbar {
            width: 8px;
            height: 8px;
        }
        ::-webkit-scrollbar-track {
            background: #fee2e2;
        }
        ::-webkit-scrollbar-thumb {
            background: #fca5a5;
            border-radius: 4px;
        }
        ::-webkit-scrollbar-thumb:hover {
            background: #f87171;
        }
        .nav-link.active {
            background-color: #b91c1c;
            color: white;
            border-right: 4px solid #fef2f2;
        }
        .table-header {
            background-color: #fef2f2;
        }
        .loader {
            border: 8px solid #f3f3f3;
            border-radius: 50%;
            border-top: 8px solid #ef4444;
            width: 60px;
            height: 60px;
            animation: spin 1s linear infinite;
        }
        @keyframes spin {
            0% { transform: rotate(0deg); }
            100% { transform: rotate(360deg); }
        }
    </style>
</head>
<body class="bg-red-50">

    <!-- Loading Overlay -->
    <div id="loader" class="loader-overlay fixed inset-0 bg-black bg-opacity-50 z-[99]">
        <div class="loader"></div>
    </div>

    <!-- Login Page -->
    <div id="login-page" class="flex items-center justify-center min-h-screen bg-gradient-to-br from-red-100 to-red-300">
        <div class="w-full max-w-md p-8 space-y-6 bg-white rounded-2xl shadow-2xl transform transition-all hover:scale-105">
            <div class="text-center">
                <img src="https://upload.wikimedia.org/wikipedia/commons/thumb/1/15/Wny-logo.png/250px-Wny-logo.png" alt="Logo" class="w-28 mx-auto mb-4 object-contain">
                <h2 class="text-3xl font-bold text-gray-800">ระบบจัดการการสอนภาษาจีน</h2>
                <p class="mt-2 text-gray-600">กรุณาลงชื่อเข้าสู่ระบบ</p>
            </div>
            <form id="login-form" class="mt-8 space-y-6">
                 <div class="relative">
                    <label for="username" class="sr-only">ชื่อผู้ใช้</label>
                    <input id="username" name="username" type="text" required class="w-full px-4 py-3 text-gray-700 bg-gray-100 border-2 border-gray-200 rounded-lg focus:outline-none focus:ring-2 focus:ring-red-500 focus:border-transparent transition" placeholder="ชื่อผู้ใช้">
                </div>
                <div class="relative">
                    <label for="password" class="sr-only">รหัสผ่าน</label>
                    <input id="password" name="password" type="password" required class="w-full px-4 py-3 text-gray-700 bg-gray-100 border-2 border-gray-200 rounded-lg focus:outline-none focus:ring-2 focus:ring-red-500 focus:border-transparent transition" placeholder="รหัสผ่าน">
                </div>
                 <p id="login-error" class="text-red-500 text-sm text-center hidden">ชื่อผู้ใช้หรือรหัสผ่านไม่ถูกต้อง</p>
                <div>
                     <button type="submit" id="login-button" class="w-full flex justify-center py-3 px-4 border border-transparent text-base font-medium rounded-md text-white bg-red-600 hover:bg-red-700 focus:outline-none focus:ring-2 focus:ring-offset-2 focus:ring-red-500 transition-transform transform hover:scale-105 shadow-lg">
                        ลงชื่อเข้าใช้
                    </button>
                </div>
            </form>
        </div>
    </div>

    <!-- Main App -->
    <div id="app" class="hidden">
        <!-- Sidebar -->
        <aside id="sidebar" class="sidebar fixed top-0 left-0 z-40 w-64 h-screen bg-gray-800 text-white shadow-xl">
            <div class="flex items-center justify-center h-20 border-b border-gray-700">
                 <img src="https://upload.wikimedia.org/wikipedia/commons/thumb/1/15/Wny-logo.png/250px-Wny-logo.png" alt="Logo" class="w-12 object-contain">
                <span class="ml-3 text-xl font-semibold">เมนูหลัก</span>
            </div>
            <nav id="admin-menu" class="mt-5 flex flex-col">
                <!-- Admin/Teacher Menu will be injected here -->
            </nav>
            <nav id="student-menu" class="mt-5 flex flex-col">
                 <!-- Student Menu will be injected here -->
            </nav>
        </aside>

        <!-- Main Content -->
        <main id="main-content" class="main-content relative ml-0 lg:ml-64">
            <!-- Header -->
            <header class="flex items-center justify-between p-4 bg-white shadow-md sticky top-0 z-30">
                <div class="flex items-center">
                     <button id="menu-toggle" class="text-gray-600 focus:outline-none lg:hidden mr-4">
                        <svg class="w-6 h-6" fill="none" stroke="currentColor" viewBox="0 0 24 24" xmlns="http://www.w3.org/2000/svg"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M4 6h16M4 12h16M4 18h16"></path></svg>
                    </button>
                    <h1 id="page-title" class="text-2xl font-bold text-gray-800">ภาพรวม</h1>
                </div>
                <div class="flex items-center">
                    <span id="user-display" class="mr-4 text-gray-700 hidden md:block"></span>
                    <button id="logout-button" class="px-4 py-2 text-sm font-medium text-white bg-red-600 rounded-lg hover:bg-red-700 focus:outline-none shadow-md transition-transform transform hover:scale-105">
                        ออกจากระบบ
                    </button>
                </div>
            </header>

            <!-- Page Content -->
            <div class="p-6">
                <!-- Dashboard View -->
                <div id="dashboard-view" class="page-view">
                     <div class="grid grid-cols-1 md:grid-cols-2 lg:grid-cols-3 gap-6">
                        <!-- Card 1 -->
                        <div class="p-6 bg-gradient-to-r from-red-500 to-red-600 text-white rounded-xl shadow-lg transform hover:scale-105 transition-transform">
                            <div class="flex items-center justify-between">
                                <div>
                                    <h3 class="text-xl font-semibold">รายวิชาที่สอน</h3>
                                    <p class="text-4xl font-bold mt-2" id="course-count">0</p>
                                </div>
                                <svg xmlns="http://www.w3.org/2000/svg" class="h-12 w-12 opacity-50" viewBox="0 0 20 20" fill="currentColor"><path d="M10.394 2.08a1 1 0 00-.788 0l-7 3a1 1 0 000 1.84L5.25 8.051a.999.999 0 011.087.017L10 10.589l3.663-2.521a.999.999 0 011.087-.017L17 6.921a1 1 0 000-1.84l-7-3zM3 9.366L10 14l7-4.634v2.978a1 1 0 01-1.727.687L10 13.589l-5.273 3.436A1 1 0 013 16.344V9.366z" /></svg>
                            </div>
                        </div>
                         <!-- Card 2 -->
                        <div class="p-6 bg-gradient-to-r from-gray-700 to-gray-800 text-white rounded-xl shadow-lg transform hover:scale-105 transition-transform">
                             <div class="flex items-center justify-between">
                                <div>
                                    <h3 class="text-xl font-semibold">จำนวนนักเรียน</h3>
                                    <p class="text-4xl font-bold mt-2" id="student-count">0</p>
                                </div>
                                <svg xmlns="http://www.w3.org/2000/svg" class="h-12 w-12 opacity-50" viewBox="0 0 20 20" fill="currentColor"><path d="M9 6a3 3 0 11-6 0 3 3 0 016 0zM17 6a3 3 0 11-6 0 3 3 0 016 0zM12.93 17c.046-.327.07-.66.07-1a6.97 6.97 0 00-1.5-4.33A5 5 0 0110 9c-1.55 0-2.958.5-4.07 1.33a6.97 6.97 0 00-1.5 4.33c0 .34.024.673.07 1h10.86zM10 20a10 10 0 100-20 10 10 0 000 20z" /></svg>
                            </div>
                        </div>
                        <!-- Card 3 -->
                        <div class="p-6 bg-gradient-to-r from-yellow-500 to-yellow-600 text-white rounded-xl shadow-lg transform hover:scale-105 transition-transform">
                             <div class="flex items-center justify-between">
                                <div>
                                    <h3 class="text-xl font-semibold">งานที่ค้างส่ง</h3>
                                    <p class="text-4xl font-bold mt-2" id="pending-assignments">0</p>
                                </div>
                                <svg xmlns="http://www.w3.org/2000/svg" class="h-12 w-12 opacity-50" viewBox="0 0 20 20" fill="currentColor"><path fill-rule="evenodd" d="M10 18a8 8 0 100-16 8 8 0 000 16zm1-12a1 1 0 10-2 0v4a1 1 0 00.293.707l2.828 2.829a1 1 0 101.414-1.415L11 9.586V6z" clip-rule="evenodd" /></svg>
                            </div>
                        </div>
                    </div>
                </div>

                <!-- Lesson Content View -->
                <div id="lessons-view" class="hidden page-view">
                    <div class="bg-white p-6 rounded-xl shadow-md">
                        <div class="flex justify-between items-center mb-4">
                            <h2 class="text-2xl font-bold text-gray-800">เนื้อหาบทเรียน</h2>
                             <button id="add-lesson-btn" class="px-4 py-2 text-white bg-red-600 rounded-lg hover:bg-red-700 shadow-md transition-transform transform hover:scale-105">เพิ่มเนื้อหา</button>
                        </div>
                        <p class="mb-6 text-gray-600">เนื้อหาบทเรียน (ตัวอย่าง)</p>
                        <div id="lesson-list" class="space-y-3">
                            <!-- Lesson items will be injected here -->
                        </div>
                    </div>
                </div>

                <!-- Assignments View -->
                <div id="assignments-view" class="hidden page-view">
                     <div class="bg-white p-6 rounded-xl shadow-md">
                        <div class="flex justify-between items-center mb-6">
                            <h2 class="text-2xl font-bold text-gray-800">ภาระงาน/ชิ้นงาน</h2>
                            <button id="add-assignment-btn" class="px-4 py-2 text-white bg-red-600 rounded-lg hover:bg-red-700 shadow-md transition-transform transform hover:scale-105">เพิ่มชิ้นงานใหม่</button>
                        </div>
                        <div id="assignment-list" class="space-y-6">
                            <!-- Assignment cards will be injected here -->
                        </div>
                    </div>
                </div>
                
                <!-- Submission Tracking View -->
                <div id="submissions-view" class="hidden page-view">
                    <div class="bg-white p-6 rounded-xl shadow-md">
                        <h2 class="text-2xl font-bold text-gray-800 mb-4">เช็คการส่งงาน</h2>
                        <div class="flex flex-wrap gap-4 mb-6">
                            <select id="class-filter" class="p-2 border border-gray-300 rounded-md focus:ring-2 focus:ring-red-500 focus:outline-none"></select>
                            <select id="assignment-filter" class="p-2 border border-gray-300 rounded-md focus:ring-2 focus:ring-red-500 focus:outline-none"></select>
                        </div>
                        <div class="overflow-x-auto">
                            <table class="min-w-full bg-white text-base">
                                <thead class="table-header">
                                    <tr>
                                        <th class="py-3 px-4 text-left font-semibold text-gray-600">เลขที่</th>
                                        <th class="py-3 px-4 text-left font-semibold text-gray-600">รหัสนักเรียน</th>
                                        <th class="py-3 px-4 text-left font-semibold text-gray-600">ชื่อ-สกุล</th>
                                        <th class="py-3 px-4 text-left font-semibold text-gray-600">สถานะ</th>
                                        <th class="py-3 px-4 text-left font-semibold text-gray-600">คะแนน</th>
                                        <th class="py-3 px-4 text-left font-semibold text-gray-600">จัดการ</th>
                                    </tr>
                                </thead>
                                <tbody id="submission-table-body">
                                </tbody>
                            </table>
                        </div>
                    </div>
                </div>
                
                <!-- Manage Students View -->
                <div id="students-view" class="hidden page-view">
                     <div class="bg-white p-6 rounded-xl shadow-md">
                         <h2 class="text-2xl font-bold text-gray-800 mb-4">จัดการนักเรียน</h2>
                         <div class="flex flex-col sm:flex-row justify-between items-center mb-6 gap-4">
                             <select id="student-class-filter" class="p-2 border border-gray-300 rounded-md focus:ring-2 focus:ring-red-500 focus:outline-none w-full sm:w-auto"></select>
                             <div class="flex gap-2">
                                <a href="data:text/csv;charset=utf-8,%E0%B8%A3%E0%B8%AB%E0%B8%B1%E0%B8%AA%E0%B8%9B%E0%B8%A3%E0%B8%B0%E0%B8%88%E0%B8%B3%E0%B8%95%E0%B8%B1%E0%B8%A7,%E0%B9%80%E0%B8%A5%E0%B8%82%E0%B8%97%E0%B8%B5%E0%B9%88,%E0%B8%8A%E0%B8%B7%E0%B9%88%E0%B8%AD-%E0%B8%99%E0%B8%B2%E0%B8%A1%E0%B8%AA%E0%B8%81%E0%B8%B8%E0%B8%A5%0A12345,1,%E0%B8%99%E0%B8%B2%E0%B8%A2%E0%B8%95%E0%B8%B1%E0%B8%A7%E0%B8%AD%E0%B8%A2%E0%B9%88%E0%B8%B2%E0%B8%87 %E0%B9%80%E0%B8%A3%E0%B8%B5%E0%B8%A2%E0%B8%99%E0%B8%94%E0%B8%B5" download="student_template.csv" class="px-4 py-2 text-white bg-green-600 rounded-lg hover:bg-green-700 shadow-md transition-transform transform hover:scale-105">ดาวน์โหลดแม่แบบ</a>
                                <label for="student-upload" class="cursor-pointer px-4 py-2 text-white bg-red-600 rounded-lg hover:bg-red-700 shadow-md transition-transform transform hover:scale-105">
                                    อัปโหลด Excel/CSV
                                    <input type="file" id="student-upload" class="hidden" accept=".csv, application/vnd.openxmlformats-officedocument.spreadsheetml.sheet, application/vnd.ms-excel">
                                 </label>
                             </div>
                         </div>
                         <div class="overflow-x-auto">
                            <table class="min-w-full bg-white text-base">
                                <thead class="table-header">
                                    <tr>
                                        <th class="py-3 px-4 text-left font-semibold text-gray-600">เลขที่</th>
                                        <th class="py-3 px-4 text-left font-semibold text-gray-600">รหัสนักเรียน</th>
                                        <th class="py-3 px-4 text-left font-semibold text-gray-600">ชื่อ-สกุล</th>
                                        <th class="py-3 px-4 text-left font-semibold text-gray-600">จัดการ</th>
                                    </tr>
                                </thead>
                                <tbody id="student-table-body"></tbody>
                            </table>
                        </div>
                     </div>
                </div>

                 <!-- Manage Teachers View (Super Admin Only) -->
                <div id="teachers-view" class="hidden page-view">
                    <div class="bg-white p-6 rounded-xl shadow-md">
                        <div class="flex justify-between items-center mb-6">
                            <h2 class="text-2xl font-bold text-gray-800">จัดการครูผู้สอน</h2>
                            <button id="add-teacher-btn" class="px-4 py-2 text-white bg-red-600 rounded-lg hover:bg-red-700 shadow-md transition-transform transform hover:scale-105">เพิ่มครูผู้สอน</button>
                        </div>
                        <div class="overflow-x-auto">
                            <table class="min-w-full bg-white text-base">
                                <thead class="table-header">
                                    <tr>
                                        <th class="py-3 px-4 text-left font-semibold text-gray-600">ชื่อ-สกุล</th>
                                        <th class="py-3 px-4 text-left font-semibold text-gray-600">ชื่อผู้ใช้</th>
                                        <th class="py-3 px-4 text-left font-semibold text-gray-600">จัดการ</th>
                                    </tr>
                                </thead>
                                <tbody id="teacher-table-body">
                                </tbody>
                            </table>
                        </div>
                    </div>
                </div>

                <!-- Profile and Courses View -->
                <div id="profile-view" class="hidden page-view">
                    <div class="bg-white p-6 rounded-xl shadow-md">
                        <h2 class="text-2xl font-bold text-gray-800 mb-6">ข้อมูลส่วนตัวและรายวิชา</h2>
                        <div class="mb-8 p-4 border rounded-lg bg-gray-50">
                            <h3 class="text-xl font-semibold mb-2 text-gray-700">ข้อมูลครูผู้สอน</h3>
                            <p><strong>ชื่อ-สกุล:</strong> <span id="profile-name" class="text-gray-600"></span></p>
                            <p><strong>ชื่อผู้ใช้:</strong> <span id="profile-username" class="text-gray-600"></span></p>
                        </div>
                         <div class="flex justify-between items-center mb-4">
                            <h3 class="text-xl font-semibold text-gray-700">รายวิชาของฉัน</h3>
                             <button id="add-course-btn" class="px-4 py-2 text-white bg-red-600 rounded-lg hover:bg-red-700 shadow-md transition-transform transform hover:scale-105">เพิ่มรายวิชา</button>
                        </div>
                        <div id="my-courses-list" class="space-y-4">
                        </div>
                    </div>
                </div>

                <!-- Student's Submissions View -->
                <div id="my-submissions-view" class="hidden page-view">
                    <div class="bg-white p-6 rounded-xl shadow-md">
                        <h2 class="text-2xl font-bold text-gray-800 mb-4">สถานะการส่งงานของฉัน</h2>
                        <div class="overflow-x-auto">
                            <table class="min-w-full bg-white text-base">
                                <thead class="table-header">
                                    <tr>
                                        <th class="py-3 px-4 text-left font-semibold text-gray-600">รายวิชา</th>
                                        <th class="py-3 px-4 text-left font-semibold text-gray-600">ชื่องาน</th>
                                        <th class="py-3 px-4 text-left font-semibold text-gray-600">สถานะ</th>
                                        <th class="py-3 px-4 text-left font-semibold text-gray-600">คะแนน</th>
                                    </tr>
                                </thead>
                                <tbody id="my-submission-table-body"></tbody>
                            </table>
                        </div>
                    </div>
                </div>
            </div>
        </main>
    </div>

    <!-- Modals -->
    <!-- Add/Edit Student Modal -->
    <div id="student-modal" class="modal fixed inset-0 bg-black bg-opacity-60 z-50">
        <div class="modal-content bg-white rounded-lg shadow-xl w-full max-w-lg p-6 m-4">
            <h3 id="student-modal-title" class="text-2xl font-bold mb-6 text-gray-800">แก้ไขข้อมูลนักเรียน</h3>
            <form id="student-form">
                <input type="hidden" id="student-original-id">
                <input type="hidden" id="student-class-id">
                <input type="hidden" id="student-row-index">
                <div class="mb-4">
                    <label for="student-number" class="block text-base font-medium text-gray-700">เลขที่</label>
                    <input type="number" id="student-number" class="mt-1 block w-full border-gray-300 rounded-md shadow-sm focus:ring-red-500 focus:border-red-500" required>
                </div>
                <div class="mb-4">
                    <label for="student-code" class="block text-base font-medium text-gray-700">รหัสนักเรียน (Username)</label>
                    <input type="text" id="student-code" class="mt-1 block w-full border-gray-300 rounded-md shadow-sm focus:ring-red-500 focus:border-red-500" required>
                </div>
                <div class="mb-4">
                    <label for="student-name" class="block text-base font-medium text-gray-700">ชื่อ-นามสกุล</label>
                    <input type="text" id="student-name" class="mt-1 block w-full border-gray-300 rounded-md shadow-sm focus:ring-red-500 focus:border-red-500" required>
                </div>
                <div class="flex justify-end gap-4 mt-8">
                    <button type="button" id="cancel-student" class="px-6 py-2 bg-gray-200 text-gray-800 rounded-lg hover:bg-gray-300 transition">ยกเลิก</button>
                    <button type="submit" class="px-6 py-2 text-white bg-red-600 rounded-lg hover:bg-red-700 transition shadow-md">บันทึก</button>
                </div>
            </form>
        </div>
    </div>
    
    <!-- Add/Edit Assignment Modal -->
    <div id="assignment-modal" class="modal fixed inset-0 bg-black bg-opacity-60 z-50">
        <div class="modal-content bg-white rounded-lg shadow-xl w-full max-w-lg p-6 m-4">
            <h3 id="assignment-modal-title" class="text-2xl font-bold mb-6 text-gray-800">เพิ่มชิ้นงานใหม่</h3>
            <form id="assignment-form">
                <input type="hidden" id="assignment-id">
                <div class="mb-4">
                    <label for="assignment-title" class="block text-base font-medium text-gray-700">หัวข้อชิ้นงาน</label>
                    <input type="text" id="assignment-title" class="mt-1 block w-full border-gray-300 rounded-md shadow-sm focus:ring-red-500 focus:border-red-500" required>
                </div>
                <div class="mb-4">
                    <label for="assignment-course" class="block text-base font-medium text-gray-700">สำหรับรายวิชา</label>
                    <select id="assignment-course" class="mt-1 block w-full border-gray-300 rounded-md shadow-sm focus:ring-red-500 focus:border-red-500" required></select>
                </div>
                <div class="mb-4">
                    <label for="assignment-description" class="block text-base font-medium text-gray-700">รายละเอียด</label>
                    <textarea id="assignment-description" rows="4" class="mt-1 block w-full border-gray-300 rounded-md shadow-sm focus:ring-red-500 focus:border-red-500"></textarea>
                </div>
                <div class="mb-4">
                    <label for="assignment-image" class="block text-base font-medium text-gray-700">รูปตัวอย่าง (URL)</label>
                    <input type="url" id="assignment-image" class="mt-1 block w-full border-gray-300 rounded-md shadow-sm focus:ring-red-500 focus:border-red-500">
                </div>
                <div class="flex justify-end gap-4 mt-8">
                    <button type="button" id="cancel-assignment" class="px-6 py-2 bg-gray-200 text-gray-800 rounded-lg hover:bg-gray-300 transition">ยกเลิก</button>
                    <button type="submit" class="px-6 py-2 text-white bg-red-600 rounded-lg hover:bg-red-700 transition shadow-md">บันทึก</button>
                </div>
            </form>
        </div>
    </div>

    <!-- Update Submission Modal -->
    <div id="submission-modal" class="modal fixed inset-0 bg-black bg-opacity-60 z-50">
         <div class="modal-content bg-white rounded-lg shadow-xl w-full max-w-sm p-6 m-4">
            <h3 class="text-2xl font-bold mb-4 text-gray-800">อัปเดตสถานะ</h3>
            <p class="mb-2 text-base"><strong>นักเรียน:</strong> <span id="submission-student-name" class="text-gray-600"></span></p>
            <p class="mb-6 text-base"><strong>งาน:</strong> <span id="submission-assignment-title" class="text-gray-600"></span></p>
            <form id="submission-form">
                 <input type="hidden" id="submission-student-id">
                 <input type="hidden" id="submission-assignment-id">
                <div class="mb-4">
                    <label for="submission-status" class="block text-base font-medium text-gray-700">สถานะ</label>
                    <select id="submission-status" class="mt-1 block w-full border-gray-300 rounded-md shadow-sm focus:ring-red-500 focus:border-red-500">
                        <option value="ค้างส่ง">ค้างส่ง</option>
                        <option value="ส่งแล้ว">ส่งแล้ว</option>
                    </select>
                </div>
                <div class="mb-4">
                    <label for="submission-score" class="block text-base font-medium text-gray-700">คะแนน</label>
                    <input type="number" id="submission-score" class="mt-1 block w-full border-gray-300 rounded-md shadow-sm focus:ring-red-500 focus:border-red-500">
                </div>
                <div class="flex justify-end gap-4 mt-8">
                    <button type="button" id="cancel-submission" class="px-6 py-2 bg-gray-200 text-gray-800 rounded-lg hover:bg-gray-300 transition">ยกเลิก</button>
                    <button type="submit" class="px-6 py-2 text-white bg-red-600 rounded-lg hover:bg-red-700 transition shadow-md">บันทึก</button>
                </div>
            </form>
        </div>
    </div>

    <script>
    document.addEventListener('DOMContentLoaded', function() {
        
        // --- Google Apps Script API Integration ---
        // IMPORTANT: Replace this URL with the one you get after deploying the Google Apps Script
        const WEB_APP_URL = 'https://script.google.com/macros/s/AKfycbzRxgg6-T9fe8MQVEt2upW87hxYQQK4dl3gKV9IWtGfdM0pIWQCwRhcZUBW8zyKTz6Q/exec';

        // This object will hold the data fetched from Google Sheets.
        let liveDatabase = {
            users: [],
            courses: [],
            students: {},
            lessons: [],
            assignments: [],
            submissions: [],
        };

        // --- State Management ---
        let appState = {
            currentUser: null,
            currentView: 'dashboard-view',
            studentCourses: [], 
        };

        // --- DOM Elements ---
        const loginPage = document.getElementById('login-page');
        const appElement = document.getElementById('app');
        const loginForm = document.getElementById('login-form');
        const loginError = document.getElementById('login-error');
        const userDisplay = document.getElementById('user-display');
        const logoutButton = document.getElementById('logout-button');
        const pageTitle = document.getElementById('page-title');
        const mainContent = document.getElementById('main-content');
        const sidebar = document.getElementById('sidebar');
        const menuToggle = document.getElementById('menu-toggle');
        const loader = document.getElementById('loader');
        
        const allViews = document.querySelectorAll('.page-view');
        
        showLoader(false); // Hide loader on initial load

        // --- Authentication & Data Loading ---
        
        loginForm.addEventListener('submit', async (e) => {
            e.preventDefault();
            const username = e.target.username.value;
            const password = e.target.password.value;
            
            showLoader(true);
            loginError.classList.add('hidden');

            try {
                // Fetch all data from the backend on login attempt
                const response = await fetch(`${WEB_APP_URL}?action=getAllData`);
                if (!response.ok) throw new Error(`HTTP error! status: ${response.status}`);
                const result = await response.json();
                
                if (result.status === 'success') {
                    liveDatabase = result.data;
                    
                    // Now, authenticate the user with the fetched data
                    const user = liveDatabase.users.find(u => u.username === username && u.password == password); // Use == for potential type coercion from sheet
                    
                    if (user) {
                        appState.currentUser = user;
                        onLoginSuccess();
                    } else {
                        loginError.classList.remove('hidden');
                    }
                } else {
                    throw new Error(result.message);
                }
            } catch (error) {
                console.error("Login failed:", error);
                loginError.textContent = "เกิดข้อผิดพลาดในการเชื่อมต่อ";
                loginError.classList.remove('hidden');
            } finally {
                showLoader(false);
            }
        });

        function onLoginSuccess() {
            loginPage.classList.add('hidden');
            appElement.classList.remove('hidden');
            initializeDashboard();
        }
        
        logoutButton.addEventListener('click', () => {
            // Reset state and UI
            appState.currentUser = null;
            appState.studentCourses = [];
            liveDatabase = { users: [], courses: [], students: {}, lessons: [], assignments: [], submissions: [] };
            loginPage.classList.remove('hidden');
            appElement.classList.add('hidden');
            loginForm.reset();
        });


        // --- Core Application Logic (Reads from liveDatabase) ---

        function initializeDashboard() {
            if (!appState.currentUser) return;
            userDisplay.textContent = `ยินดีต้อนรับ, ${appState.currentUser.name}`;
            
            if (appState.currentUser.role === 'student') {
                appState.studentCourses = liveDatabase.courses.filter(course => {
                    return course.rooms && course.rooms.includes(appState.currentUser.classId)
                });
                navigateTo('lessons-view', 'เนื้อหาบทเรียน');
            } else {
                navigateTo('dashboard-view', 'ภาพรวม');
            }
            setupMenus();
        }

        // --- Render Functions (Reads from liveDatabase) ---
        function renderDashboard() {
            const teacherId = appState.currentUser.id;
            const courses = liveDatabase.courses.filter(c => c.teacherId == teacherId);
            const myRooms = courses.flatMap(c => c.rooms);
            
            const studentCount = Object.entries(liveDatabase.students)
                .filter(([room, students]) => myRooms.includes(room))
                .reduce((acc, [room, students]) => acc + (students ? students.length : 0), 0);

            const myCourseIds = courses.map(c => c.id);
            const myAssignmentIds = liveDatabase.assignments
                .filter(a => myCourseIds.includes(a.courseId))
                .map(a => a.id);

            const pendingCount = liveDatabase.submissions
                .filter(s => myAssignmentIds.includes(s.assignmentId) && s.status === 'ค้างส่ง')
                .length;
            
            document.getElementById('course-count').textContent = courses.length;
            document.getElementById('student-count').textContent = studentCount;
            document.getElementById('pending-assignments').textContent = pendingCount;
        }

        function renderStudents() {
            const classFilter = document.getElementById('student-class-filter');
            const tableBody = document.getElementById('student-table-body');
            const myRooms = liveDatabase.courses
                .filter(c => c.teacherId == appState.currentUser.id)
                .flatMap(c => c.rooms);
            
            classFilter.innerHTML = [...new Set(myRooms)].map(room => `<option value="${room}">${room}</option>`).join('');

            function updateStudentTable() {
                 const selectedClass = classFilter.value;
                 const studentsInClass = liveDatabase.students[selectedClass] || [];
                 tableBody.innerHTML = '';

                 if (studentsInClass.length === 0) {
                    tableBody.innerHTML = '<tr><td colspan="4" class="text-center py-8 text-gray-500">ไม่พบข้อมูลนักเรียนในห้องนี้</td></tr>';
                    return;
                }
                
                 [...studentsInClass].sort((a,b) => a.number - b.number).forEach(student => {
                     const row = document.createElement('tr');
                     row.className = 'hover:bg-gray-50 transition-colors';
                     row.innerHTML = `
                        <td class="py-3 px-4 border-b border-gray-200">${student.number}</td>
                        <td class="py-3 px-4 border-b border-gray-200">${student.studentId}</td>
                        <td class="py-3 px-4 border-b border-gray-200">${student.name}</td>
                        <td class="py-3 px-4 border-b border-gray-200 flex gap-4">
                           <button class="edit-student-btn text-blue-600 hover:text-blue-800 font-medium" 
                                data-original-id="${student.studentId}"
                                data-class-id="${selectedClass}"
                                data-row-index="${student.rowIndex}"
                                data-number="${student.number}"
                                data-code="${student.studentId}"
                                data-name="${student.name}">แก้ไข</button>
                           <button class="text-red-600 hover:text-red-800 font-medium">ลบ</button>
                        </td>
                    `;
                    tableBody.appendChild(row);
                 });

                 document.querySelectorAll('.edit-student-btn').forEach(btn => btn.addEventListener('click', openStudentEditModal));
            }
             classFilter.addEventListener('change', updateStudentTable);
             if (myRooms.length > 0) updateStudentTable();
        }

        function renderSubmissions() {
            const classFilter = document.getElementById('class-filter');
            const assignmentFilter = document.getElementById('assignment-filter');
            const tableBody = document.getElementById('submission-table-body');

            const teacherId = appState.currentUser.id;
            const myCourses = liveDatabase.courses.filter(c => c.teacherId == teacherId);
            const myRooms = [...new Set(myCourses.flatMap(c => c.rooms))];
            
            classFilter.innerHTML = myRooms.map(room => `<option value="${room}">${room}</option>`).join('');
            
            const myCourseIds = myCourses.map(c => c.id);
            assignmentFilter.innerHTML = liveDatabase.assignments
                .filter(a => myCourseIds.includes(a.courseId))
                .map(a => `<option value="${a.id}">${a.title}</option>`).join('');

            function updateTable() {
                const selectedClass = classFilter.value;
                const selectedAssignmentId = assignmentFilter.value;
                const studentsInClass = liveDatabase.students[selectedClass] || [];
                tableBody.innerHTML = '';

                if (studentsInClass.length === 0 || !selectedAssignmentId) {
                    tableBody.innerHTML = '<tr><td colspan="6" class="text-center py-8 text-gray-500">ไม่พบข้อมูลนักเรียนในห้องนี้ หรือยังไม่ได้เลือกชิ้นงาน</td></tr>';
                    return;
                }

                [...studentsInClass].sort((a,b) => a.number - b.number).forEach(student => {
                    const submission = liveDatabase.submissions.find(s => s.studentId == student.studentId && s.assignmentId == selectedAssignmentId);
                    const status = submission ? submission.status : 'ค้างส่ง';
                    const score = submission ? (submission.score != null ? submission.score : '-') : '-';
                    const statusChip = status === 'ส่งแล้ว' 
                        ? '<span class="px-3 py-1 text-sm font-medium text-green-800 bg-green-100 rounded-full">ส่งแล้ว</span>' 
                        : '<span class="px-3 py-1 text-sm font-medium text-red-800 bg-red-100 rounded-full">ค้างส่ง</span>';

                    const row = document.createElement('tr');
                    row.className = 'hover:bg-gray-50 transition-colors';
                    row.innerHTML = `
                        <td class="py-3 px-4 border-b border-gray-200">${student.number}</td>
                        <td class="py-3 px-4 border-b border-gray-200">${student.studentId}</td>
                        <td class="py-3 px-4 border-b border-gray-200">${student.name}</td>
                        <td class="py-3 px-4 border-b border-gray-200">${statusChip}</td>
                        <td class="py-3 px-4 border-b border-gray-200">${score}</td>
                        <td class="py-3 px-4 border-b border-gray-200">
                            <button class="edit-submission-btn px-4 py-2 text-sm text-white bg-red-600 rounded-md hover:bg-red-700" data-student-id="${student.studentId}" data-student-name="${student.name}" data-assignment-id="${selectedAssignmentId}">อัปเดต</button>
                        </td>
                    `;
                    tableBody.appendChild(row);
                });
                
                 document.querySelectorAll('.edit-submission-btn').forEach(btn => {
                    btn.addEventListener('click', openSubmissionModal);
                });
            }

            classFilter.addEventListener('change', updateTable);
            assignmentFilter.addEventListener('change', updateTable);
            if(myRooms.length > 0) updateTable();
        }

        function renderAssignments() {
            const list = document.getElementById('assignment-list');
            list.innerHTML = '';
            const isStudent = appState.currentUser.role === 'student';
            document.getElementById('add-assignment-btn').style.display = isStudent ? 'none' : 'block';

            let assignmentsToShow = [];
            if (isStudent) {
                const studentCourseIds = appState.studentCourses.map(c => c.id);
                assignmentsToShow = liveDatabase.assignments.filter(assign => studentCourseIds.includes(assign.courseId));
            } else {
                const teacherCourseIds = liveDatabase.courses.filter(c => c.teacherId == appState.currentUser.id).map(c => c.id);
                assignmentsToShow = liveDatabase.assignments.filter(assign => teacherCourseIds.includes(assign.courseId));
            }

            if (assignmentsToShow.length === 0) {
                list.innerHTML = `<p class="text-gray-500 text-center py-4">ไม่พบภาระงาน</p>`;
                return;
            }

            assignmentsToShow.forEach(assign => {
                const course = liveDatabase.courses.find(c => c.id == assign.courseId);
                let statusHtml = '';

                if (isStudent) {
                    const submission = liveDatabase.submissions.find(s => s.studentId == appState.currentUser.studentId && s.assignmentId == assign.id);
                    const status = submission ? submission.status : 'ค้างส่ง';
                    if (status === 'ส่งแล้ว') {
                        statusHtml = `<div class="mt-3"><span class="px-3 py-1 text-sm font-medium text-green-800 bg-green-100 rounded-full">ส่งแล้ว</span></div>`;
                    } else {
                        statusHtml = `<div class="mt-3"><span class="px-3 py-1 text-sm font-medium text-red-800 bg-red-100 rounded-full">ค้างส่ง</span></div>`;
                    }
                }

                const card = document.createElement('div');
                card.className = 'p-5 bg-white rounded-lg border border-gray-200 shadow-sm transition-shadow hover:shadow-lg';
                card.innerHTML = `
                    <div class="flex justify-between items-start">
                        <div>
                            <h4 class="text-xl font-bold text-gray-800">${assign.title}</h4>
                            <p class="text-sm text-gray-500 mt-1">${course?.name} (${course?.code})</p>
                            <p class="mt-3 text-gray-700">${assign.description}</p>
                            ${statusHtml}
                        </div>
                        ${ !isStudent ?
                        `<div class="flex gap-2 flex-shrink-0 ml-4">
                             <button class="text-gray-600 hover:text-gray-800 transition-colors">แก้ไข</button>
                             <button class="text-red-600 hover:text-red-800 transition-colors">ลบ</button>
                         </div>` : ''
                        }
                    </div>
                    ${assign.imageUrl ? `<img src="${assign.imageUrl}" alt="ตัวอย่าง" class="mt-4 rounded-lg max-w-sm mx-auto shadow-md">` : ''}
                `;
                list.appendChild(card);
            });
        }
        
        function renderMySubmissions() {
            const tableBody = document.getElementById('my-submission-table-body');
            tableBody.innerHTML = '';
            const studentCourseIds = appState.studentCourses.map(c => c.id);
            const assignments = liveDatabase.assignments.filter(a => studentCourseIds.includes(a.courseId));
            
            if (assignments.length === 0) {
                 tableBody.innerHTML = '<tr><td colspan="4" class="text-center py-8 text-gray-500">ยังไม่มีการมอบหมายงาน</td></tr>';
                 return;
            }

            assignments.forEach(assign => {
                const course = liveDatabase.courses.find(c => c.id == assign.courseId);
                const submission = liveDatabase.submissions.find(s => s.studentId == appState.currentUser.studentId && s.assignmentId == assign.id);
                const status = submission ? submission.status : 'ค้างส่ง';
                const score = submission ? (submission.score != null ? submission.score : '-') : '-';
                const statusChip = status === 'ส่งแล้ว' 
                    ? '<span class="px-3 py-1 text-sm font-medium text-green-800 bg-green-100 rounded-full">ส่งแล้ว</span>' 
                    : '<span class="px-3 py-1 text-sm font-medium text-red-800 bg-red-100 rounded-full">ค้างส่ง</span>';
                
                const row = document.createElement('tr');
                row.className = 'hover:bg-gray-50 transition-colors';
                row.innerHTML = `
                    <td class="py-3 px-4 border-b border-gray-200">${course?.name}</td>
                    <td class="py-3 px-4 border-b border-gray-200">${assign.title}</td>
                    <td class="py-3 px-4 border-b border-gray-200">${statusChip}</td>
                    <td class="py-3 px-4 border-b border-gray-200">${score}</td>
                `;
                tableBody.appendChild(row);
            });
        }
        
        // This is a placeholder as drive integration is more complex
         function renderLessons() {
             const list = document.getElementById('lesson-list');
             list.innerHTML = '';
             const isStudent = appState.currentUser.role === 'student';
             document.getElementById('add-lesson-btn').style.display = isStudent ? 'none' : 'block';
             
             let lessonsToShow = liveDatabase.lessons || [];

             if (lessonsToShow.length === 0) {
                list.innerHTML = `<p class="text-gray-500 text-center py-4">ไม่พบเนื้อหาบทเรียน</p>`;
                return;
             }

             lessonsToShow.forEach(lesson => {
                 const li = document.createElement('li');
                 li.className = 'flex justify-between items-center p-4 bg-gray-50 rounded-lg border border-gray-200 hover:shadow-md hover:border-red-400 transition-shadow';
                 li.innerHTML = `
                    <span class="text-lg text-gray-800">${lesson.title}</span>
                    <a href="${lesson.url}" target="_blank" class="px-4 py-2 text-sm text-white bg-green-600 rounded-md hover:bg-green-700 transition-transform transform hover:scale-105">เปิดดู</a>
                 `;
                 list.appendChild(li);
             });
        }
        
        // --- Modal & Form Submission Logic (Writes via Apps Script API) ---
        
        document.getElementById('student-form').addEventListener('submit', async (e) => {
            e.preventDefault();
            const originalId = document.getElementById('student-original-id').value;
            const classId = document.getElementById('student-class-id').value;
            const rowIndex = document.getElementById('student-row-index').value;
            const newNumber = document.getElementById('student-number').value;
            const newCode = document.getElementById('student-code').value;
            const newName = document.getElementById('student-name').value;
            
            showLoader(true);
            
            const params = new URLSearchParams({
                action: 'updateStudent',
                classId,
                rowIndex,
                studentId: newCode, // send the new code
                number: newNumber,
                name: newName
            });
            
            try {
                const response = await fetch(`${WEB_APP_URL}?${params.toString()}`);
                const result = await response.json();
                if(result.status !== 'success') throw new Error(result.message);

                // Update local liveDatabase to reflect changes immediately
                const studentList = liveDatabase.students[classId];
                const student = studentList.find(s => s.rowIndex == rowIndex);
                if (student) {
                    student.number = parseInt(newNumber);
                    student.studentId = newCode;
                    student.name = newName;
                }
                const user = liveDatabase.users.find(u => u.username === originalId);
                if(user) {
                   user.username = newCode;
                   user.password = newCode;
                   user.name = newName;
                   user.studentId = newCode;
                }
                document.getElementById('student-modal').classList.remove('active');
                renderStudents();
            } catch(error) {
                 console.error('Failed to update student:', error);
                 alert('ไม่สามารถอัปเดตข้อมูลนักเรียนได้');
            } finally {
                showLoader(false);
            }
        });

        document.getElementById('submission-form').addEventListener('submit', async function(e) {
            e.preventDefault();
            const studentId = document.getElementById('submission-student-id').value;
            const assignmentId = document.getElementById('submission-assignment-id').value;
            const status = document.getElementById('submission-status').value;
            const score = document.getElementById('submission-score').value;

            showLoader(true);
            const params = new URLSearchParams({
                action: 'updateSubmission',
                studentId,
                assignmentId,
                status,
                score
            });

            try {
                const response = await fetch(`${WEB_APP_URL}?${params.toString()}`);
                const result = await response.json();
                if(result.status !== 'success') throw new Error(result.message);

                // Update local data
                let submission = liveDatabase.submissions.find(s => s.studentId == studentId && s.assignmentId == assignmentId);
                if (submission) {
                    submission.status = status;
                    submission.score = score ? parseFloat(score) : null;
                } else {
                    // Add new submission to local data
                    liveDatabase.submissions.push({ studentId, assignmentId, status, score: score ? parseFloat(score) : null, rowIndex: 'new'});
                }
                document.getElementById('submission-modal').classList.remove('active');
                renderSubmissions(); 
            } catch(error) {
                 console.error('Failed to update submission:', error);
                 alert('ไม่สามารถอัปเดตสถานะการส่งงานได้');
            } finally {
                showLoader(false);
            }
        });


        // --- Helper, UI, and Unchanged Functions ---
        function showLoader(show) {
            loader.style.display = show ? 'flex' : 'none';
        }
        
        function openStudentEditModal(e) {
            const btn = e.currentTarget;
            document.getElementById('student-original-id').value = btn.dataset.originalId;
            document.getElementById('student-class-id').value = btn.dataset.classId;
            document.getElementById('student-row-index').value = btn.dataset.rowIndex;
            document.getElementById('student-number').value = btn.dataset.number;
            document.getElementById('student-code').value = btn.dataset.code;
            document.getElementById('student-name').value = btn.dataset.name;
            document.getElementById('student-modal').classList.add('active');
        }

        function openSubmissionModal(e) {
            const btn = e.currentTarget;
            const studentId = btn.dataset.studentId;
            const studentName = btn.dataset.studentName;
            const assignmentId = btn.dataset.assignmentId;
            const assignment = liveDatabase.assignments.find(a => a.id == assignmentId);
            const submission = liveDatabase.submissions.find(s => s.studentId == studentId && s.assignmentId == assignmentId);

            document.getElementById('submission-student-name').textContent = studentName;
            document.getElementById('submission-assignment-title').textContent = assignment.title;
            document.getElementById('submission-student-id').value = studentId;
            document.getElementById('submission-assignment-id').value = assignmentId;
            document.getElementById('submission-status').value = submission ? submission.status : 'ค้างส่ง';
            document.getElementById('submission-score').value = submission ? (submission.score || '') : '';

            document.getElementById('submission-modal').classList.add('active');
        }

        document.getElementById('cancel-student').addEventListener('click', () => document.getElementById('student-modal').classList.remove('active'));
        document.getElementById('cancel-submission').addEventListener('click', () => document.getElementById('submission-modal').classList.remove('active'));


        function setupMenus() {
            const adminMenu = document.getElementById('admin-menu');
            const studentMenu = document.getElementById('student-menu');
            adminMenu.innerHTML = '';
            studentMenu.innerHTML = '';
            
            const menuIcons = {
                'dashboard-view': `<svg xmlns="http://www.w3.org/2000/svg" class="h-6 w-6 mr-3" fill="none" viewBox="0 0 24 24" stroke="currentColor"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M4 6a2 2 0 012-2h2a2 2 0 012 2v2a2 2 0 01-2 2H6a2 2 0 01-2-2V6zM14 6a2 2 0 012-2h2a2 2 0 012 2v2a2 2 0 01-2 2h-2a2 2 0 01-2-2V6zM4 16a2 2 0 012-2h2a2 2 0 012 2v2a2 2 0 01-2 2H6a2 2 0 01-2-2v-2zM14 16a2 2 0 012-2h2a2 2 0 012 2v2a2 2 0 01-2 2h-2a2 2 0 01-2-2v-2z" /></svg>`,
                'lessons-view': `<svg xmlns="http://www.w3.org/2000/svg" class="h-6 w-6 mr-3" fill="none" viewBox="0 0 24 24" stroke="currentColor"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M12 6.253v11.494m-9-5.747h18" /></svg>`,
                'assignments-view': `<svg xmlns="http://www.w3.org/2000/svg" class="h-6 w-6 mr-3" fill="none" viewBox="0 0 24 24" stroke="currentColor"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M9 5H7a2 2 0 00-2 2v12a2 2 0 002 2h10a2 2 0 002-2V7a2 2 0 00-2-2h-2M9 5a2 2 0 002 2h2a2 2 0 002-2M9 5a2 2 0 012-2h2a2 2 0 012 2m-3 7h3m-3 4h3m-6-4h.01M9 16h.01" /></svg>`,
                'submissions-view': `<svg xmlns="http://www.w3.org/2000/svg" class="h-6 w-6 mr-3" fill="none" viewBox="0 0 24 24" stroke="currentColor"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M9 12l2 2 4-4m6 2a9 9 0 11-18 0 9 9 0 0118 0z" /></svg>`,
                'students-view': `<svg xmlns="http://www.w3.org/2000/svg" class="h-6 w-6 mr-3" fill="none" viewBox="0 0 24 24" stroke="currentColor"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M17 20h5v-2a3 3 0 00-5.356-1.857M17 20H7m10 0v-2c0-.656-.126-1.283-.356-1.857M7 20H2v-2a3 3 0 015.356-1.857M7 20v-2c0-.656.126-1.283.356-1.857m0 0a5.002 5.002 0 019.288 0M15 7a3 3 0 11-6 0 3 3 0 016 0zm6 3a2 2 0 11-4 0 2 2 0 014 0zM7 10a2 2 0 11-4 0 2 2 0 014 0z" /></svg>`,
                'profile-view': `<svg xmlns="http://www.w3.org/2000/svg" class="h-6 w-6 mr-3" fill="none" viewBox="0 0 24 24" stroke="currentColor"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M16 7a4 4 0 11-8 0 4 4 0 018 0zM12 14a7 7 0 00-7 7h14a7 7 0 00-7-7z" /></svg>`,
                'teachers-view': `<svg xmlns="http://www.w3.org/2000/svg" class="h-6 w-6 mr-3" fill="none" viewBox="0 0 24 24" stroke="currentColor"><path d="M12 4.354a4 4 0 110 5.292M15 21H3v-1a6 6 0 0112 0v1zm0 0h6v-1a6 6 0 00-9-5.197M15 21a6 6 0 00-9-5.197M15 21a6 6 0 006-6v-1a6 6 0 00-9-5.197" /></svg>`
            }

            if (appState.currentUser.role.includes('admin') || appState.currentUser.role === 'teacher') {
                let menuHtml = `
                    <a href="#" data-view="dashboard-view" data-title="ภาพรวม" class="nav-link flex items-center px-6 py-4 text-gray-300 hover:bg-red-700 hover:text-white transition-colors duration-200">${menuIcons['dashboard-view']}ภาพรวม</a>
                    <a href="#" data-view="lessons-view" data-title="เนื้อหาบทเรียน" class="nav-link flex items-center px-6 py-4 text-gray-300 hover:bg-red-700 hover:text-white transition-colors duration-200">${menuIcons['lessons-view']}เนื้อหาบทเรียน</a>
                    <a href="#" data-view="assignments-view" data-title="ภาระงาน/ชิ้นงาน" class="nav-link flex items-center px-6 py-4 text-gray-300 hover:bg-red-700 hover:text-white transition-colors duration-200">${menuIcons['assignments-view']}ภาระงาน/ชิ้นงาน</a>
                    <a href="#" data-view="submissions-view" data-title="เช็คการส่งงาน" class="nav-link flex items-center px-6 py-4 text-gray-300 hover:bg-red-700 hover:text-white transition-colors duration-200">${menuIcons['submissions-view']}เช็คการส่งงาน</a>
                    <a href="#" data-view="students-view" data-title="จัดการนักเรียน" class="nav-link flex items-center px-6 py-4 text-gray-300 hover:bg-red-700 hover:text-white transition-colors duration-200">${menuIcons['students-view']}จัดการนักเรียน</a>
                    <a href="#" data-view="profile-view" data-title="ข้อมูลส่วนตัวและรายวิชา" class="nav-link flex items-center px-6 py-4 text-gray-300 hover:bg-red-700 hover:text-white transition-colors duration-200">${menuIcons['profile-view']}ข้อมูลส่วนตัว</a>
                `;
                 if (appState.currentUser.role === 'super-admin') {
                     menuHtml += `<a href="#" data-view="teachers-view" data-title="จัดการครูผู้สอน" class="nav-link flex items-center px-6 py-4 text-gray-300 hover:bg-red-700 hover:text-white transition-colors duration-200">${menuIcons['teachers-view']}จัดการครูผู้สอน</a>`;
                }
                adminMenu.innerHTML = menuHtml;
                studentMenu.classList.add('hidden');
                adminMenu.classList.remove('hidden');

            } else { // Student
                studentMenu.innerHTML = `
                    <a href="#" data-view="lessons-view" data-title="เนื้อหาบทเรียน" class="nav-link flex items-center px-6 py-4 text-gray-300 hover:bg-red-700 hover:text-white transition-colors duration-200">${menuIcons['lessons-view']}เนื้อหาบทเรียน</a>
                    <a href="#" data-view="assignments-view" data-title="ภาระงาน/ชิ้นงาน" class="nav-link flex items-center px-6 py-4 text-gray-300 hover:bg-red-700 hover:text-white transition-colors duration-200">${menuIcons['assignments-view']}ภาระงาน/ชิ้นงาน</a>
                    <a href="#" data-view="my-submissions-view" data-title="สถานะการส่งงาน" class="nav-link flex items-center px-6 py-4 text-gray-300 hover:bg-red-700 hover:text-white transition-colors duration-200">${menuIcons['submissions-view']}สถานะการส่งงาน</a>
                `;
                adminMenu.classList.add('hidden');
                studentMenu.classList.remove('hidden');
            }
             document.querySelectorAll('.nav-link').forEach(link => {
                link.addEventListener('click', (e) => {
                    e.preventDefault();
                    document.querySelectorAll('.nav-link').forEach(l => l.classList.remove('active'));
                    e.currentTarget.classList.add('active');
                    navigateTo(e.currentTarget.dataset.view, e.currentTarget.dataset.title);
                     if (window.innerWidth < 1024) {
                        sidebar.classList.add('-translate-x-full');
                    }
                });
            });
        }
        
        function navigateTo(viewId, title) {
            allViews.forEach(view => view.classList.add('hidden'));
            const targetView = document.getElementById(viewId);
            if (targetView) {
                targetView.classList.remove('hidden');
                pageTitle.textContent = title;
                appState.currentView = viewId;
                
                document.querySelectorAll('.nav-link').forEach(l => l.classList.remove('active'));
                const activeLink = document.querySelector(`.nav-link[data-view="${viewId}"]`);
                if(activeLink) activeLink.classList.add('active');

                const renderMap = {
                    'dashboard-view': renderDashboard,
                    'lessons-view': renderLessons,
                    'assignments-view': renderAssignments,
                    'submissions-view': renderSubmissions,
                    'students-view': renderStudents,
                    // 'teachers-view': renderTeachers,
                    // 'profile-view': renderProfile,
                    'my-submissions-view': renderMySubmissions,
                };
                if(renderMap[viewId]) renderMap[viewId]();
            }
        }

        sidebar.classList.add('-translate-x-full', 'lg:translate-x-0');
        menuToggle.addEventListener('click', () => {
            sidebar.classList.toggle('-translate-x-full');
        });

    });
    </script>
</body>
</html>

